{"version":3,"sources":["src/pages/Auth/Callback/index.tsx"],"sourcesContent":["import { useEffect } from \"react\";\r\nimport { useModel, history } from \"@umijs/max\";\r\nimport { authingClient } from \"@/utils/auth\";\r\n\r\nexport default function Callback() {\r\n  const { setInitialState } = useModel(\"@@initialState\");\r\n\r\n  useEffect(() => {\r\n    const handleCallback = async () => {\r\n      try {\r\n        // 处理登录回调\r\n        const token = await authingClient.handleRedirectCallback();\r\n\r\n        if (token) {\r\n          const { parsedIdToken: userInfo = {} } = token || {};\r\n          localStorage.setItem(\"authing_token\", JSON.stringify(token));\r\n          localStorage.setItem(\"authing_user\", JSON.stringify(userInfo));\r\n\r\n          console.log(\"登录成功，token 信息:\", token);\r\n          console.log(\"登录成功，用户信息:\", userInfo);\r\n\r\n          setInitialState((s) => ({\r\n            ...s,\r\n            currentUser: {\r\n              name: userInfo.name,\r\n              avatar: userInfo.picture,\r\n              userid: userInfo.aud,\r\n              email: userInfo.email,\r\n              ...userInfo,\r\n            },\r\n          }));\r\n          history.push(\"/\");\r\n        }\r\n      } catch (error: any) {\r\n        console.error(\"登录回调处理失败:\", error);\r\n        history.push(\"/auth/login?error=\" + encodeURIComponent(error.message));\r\n      }\r\n    };\r\n\r\n    handleCallback();\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"cs-flex cs-items-center cs-justify-center cs-min-h-screen cs-bg-gray-100\">\r\n      <div className=\"cs-text-center\">\r\n        <div className=\"cs-animate-spin cs-rounded-full cs-h-12 cs-w-12 cs-border-b-4 cs-border-blue-600 cs-mx-auto cs-mb-4\"></div>\r\n        <p className=\"cs-text-lg cs-text-gray-700\">正在处理登录，请稍候...</p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"+PAIA,+CAAwB,8BAJE,gBACQ,gBACJ,YAEf,SAAS,IACtB,GAAM,CAAE,gBAAA,CAAe,CAAE,CAAG,GAAA,UAAQ,EAAC,kBAqCrC,MAnCA,GAAA,WAAS,EAAC,KAgCR,AA/BuB,CAAA,UACrB,GAAI,CAEF,IAAM,EAAQ,MAAM,eAAa,CAAC,sBAAsB,GAExD,GAAI,EAAO,CACT,GAAM,CAAE,cAAe,EAAW,CAAC,CAAC,CAAE,CAAG,GAAS,CAAC,EACnD,aAAa,OAAO,CAAC,gBAAiB,KAAK,SAAS,CAAC,IACrD,aAAa,OAAO,CAAC,eAAgB,KAAK,SAAS,CAAC,IAEpD,QAAQ,GAAG,CAAC,oDAAkB,GAC9B,QAAQ,GAAG,CAAC,0DAAc,GAE1B,EAAgB,AAAC,GAAO,CAAA,CACtB,GAAG,CAAC,CACJ,YAAa,CACX,KAAM,EAAS,IAAI,CACnB,OAAQ,EAAS,OAAO,CACxB,OAAQ,EAAS,GAAG,CACpB,MAAO,EAAS,KAAK,CACrB,GAAG,CAAQ,AACb,CACF,CAAA,GACA,SAAO,CAAC,IAAI,CAAC,KACf,CACF,CAAE,MAAO,EAAY,CACnB,QAAQ,KAAK,CAAC,oDAAa,GAC3B,SAAO,CAAC,IAAI,CAAC,qBAAuB,mBAAmB,EAAM,OAAO,GACtE,CACF,CAAA,IAGF,EAAG,EAAE,EAGH,UAAC,OAAI,UAAU,oFACb,WAAC,OAAI,UAAU,2BACb,UAAC,OAAI,UAAU,wGACf,UAAC,KAAE,UAAU,uCAA8B,yEAInD"}